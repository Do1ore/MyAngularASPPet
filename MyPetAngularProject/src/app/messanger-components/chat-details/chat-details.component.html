<div *ngIf="!chatId || chatId === ''" class="p-4 sm:ml-64 pt-24">
  <div class="p-4 border-2 border-gray-200 border-dashed rounded-lg dark:border-gray-700">
    <div class="grid grid-cols-3 gap-4 mb-4">
      <div class="flex items-center justify-center h-24 rounded bg-gray-50 dark:bg-gray-800">
        <p class="text-2xl text-gray-400 dark:text-gray-500">+</p>
      </div>
      <div class="flex items-center justify-center h-24 rounded bg-gray-50 dark:bg-gray-800">
        <p class="text-2xl text-gray-400 dark:text-gray-500">+</p>
      </div>
      <div class="flex items-center justify-center h-24 rounded bg-gray-50 dark:bg-gray-800">
        <p class="text-2xl text-gray-400 dark:text-gray-500">+</p>
      </div>
    </div>
    <div class="flex items-center justify-center h-48 mb-4 rounded bg-gray-50 dark:bg-gray-800">
      <p class="text-2xl text-gray-400 dark:text-gray-500">+</p>
    </div>
    <div class="grid grid-cols-2 gap-4 mb-4">
      <div class="flex items-center justify-center rounded bg-gray-50 h-28 dark:bg-gray-800">
        <p class="text-2xl text-gray-400 dark:text-gray-500">+</p>
      </div>
      <div class="flex items-center justify-center rounded bg-gray-50 h-28 dark:bg-gray-800">
        <p class="text-2xl text-gray-400 dark:text-gray-500">+</p>
      </div>
      <div class="flex items-center justify-center rounded bg-gray-50 h-28 dark:bg-gray-800">
        <p class="text-2xl text-gray-400 dark:text-gray-500">+</p>
      </div>
      <div class="flex items-center justify-center rounded bg-gray-50 h-28 dark:bg-gray-800">
        <p class="text-2xl text-gray-400 dark:text-gray-500">+</p>
      </div>
    </div>
    <div class="flex items-center justify-center h-48 mb-4 rounded bg-gray-50 dark:bg-gray-800">
      <p class="text-2xl text-gray-400 dark:text-gray-500">+</p>
    </div>
    <div class="grid grid-cols-2 gap-4">
      <div class="flex items-center justify-center rounded bg-gray-50 h-28 dark:bg-gray-800">
        <p class="text-2xl text-gray-400 dark:text-gray-500">+</p>
      </div>
      <div class="flex items-center justify-center rounded bg-gray-50 h-28 dark:bg-gray-800">
        <p class="text-2xl text-gray-400 dark:text-gray-500">+</p>
      </div>
      <div class="flex items-center justify-center rounded bg-gray-50 h-28 dark:bg-gray-800">
        <p class="text-2xl text-gray-400 dark:text-gray-500">+</p>
      </div>
      <div class="flex items-center justify-center rounded bg-gray-50 h-28 dark:bg-gray-800">
        <p class="text-2xl text-gray-400 dark:text-gray-500">+</p>
      </div>
    </div>
  </div>
</div>

<div *ngIf="chatId" class="p-4 sm:ml-64 pt-24">
  <div class="p-4 rounded-full dark:border-gray-700">
    <div class="grid mb-4">
      <div class="flex h-fit p-3 pl-5 items-center rounded bg-gray-50 dark:bg-gray-800">
        <div class="flex-row justify-start items-start">

          <div class="flex items-center mb-4">
            <img [src]="safeChatImgProfileUrl"
                 class="w-20 h-20 p-1 rounded-full ring-2 ring-gray-300 dark:ring-gray-500 object-cover me-4"
                 alt="chat image">

            <h1
              class="self-center mb-4 text-3xl font-extrabold text-gray-900 dark:text-white md:text-5xl lg:text-6xl me-2">
              <div class="flex flex-row">
              <span
                class="text-transparent bg-clip-text bg-gradient-to-r to-emerald-600 from-sky-400 me-2">{{chatModel.name}}</span>
              </div>
            </h1>

            <!-- Edit button-->
            <button (click)="toggleEditModal()"
                    type="button"
                    class="hover:px-6 text-white bg-gradient-to-r from-blue-500 via-blue-600 to-blue-700 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-blue-300 dark:focus:ring-blue-800 shadow-lg shadow-blue-500/50 dark:shadow-lg dark:shadow-blue-800/80 font-medium rounded-lg text-sm px-5 py-2.5 text-center mr-2 mb-2  duration-300 ">
              <svg class="w-6 h-6 text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"
                   fill="none" viewBox="0 0 21 21">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M7.418 17.861 1 20l2.139-6.418m4.279 4.279 10.7-10.7a3.027 3.027 0 0 0-2.14-5.165c-.802 0-1.571.319-2.139.886l-10.7 10.7m4.279 4.279-4.279-4.279m2.139 2.14 7.844-7.844m-1.426-2.853 4.279 4.279"/>
              </svg>
              Edit
            </button>

          </div>
          <span
            class="justify-center items-center float-none text-2xl dark:text-gray-50 me-3">Users: {{chatModel.appUsers.length}}</span>
          <button
            (click)="toggleDeleteModal()"
            type="button"
            class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-full text-sm p-2.5 text-center inline-flex items-center mr-2 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round"
                    d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"></path>
            </svg>
            <span class="sr-only">Icon description</span>
          </button>
        </div>
      </div>
    </div>

    <!--    ChatMessages-->
    <ng-template ngFor let-message [ngForOf]="chatModel.messages">
      <!--Current user-->
      <div *ngIf="message.senderId === userId">


        <div
          class="text-green-800 bg-green-100 dark:bg-green-900 rounded-md mt-2 p-3 ml-auto dark:text-green-50 w-fit flex flex-row items-center">

          <div *ngIf="userImageService.getUserProfileById(message.senderId); else elseBlock">
            <img
              class="relative inline-flex items-center overflow-hidden w-10 h-10 p-1 rounded-full ring-2 ring-gray-300 dark:ring-gray-500 me-2"
              [src]="userImageService.getUserProfileById(message.senderId)" alt="Bordered avatar">
          </div>
          <ng-template #elseBlock>
            <div
              class="relative  inline-flex items-center justify-center w-10 h-10 overflow-hidden bg-gray-100 rounded-full dark:bg-gray-600">
            <span
              class="font-medium text-gray-600 dark:text-gray-300">{{getUserCredentials(message.senderId)}}</span>
            </div>
          </ng-template>

          <mark
            class="me-4 p-1 bg-transparent dark:text-blue-50
            font-bold">{{getUserBySenderId(message.senderId).username!}}</mark>
          <span class="text-black dark:text-green-200 me-4">{{message.content}}</span>
          <mark
            class="text-green-900  bg-green-300 dark:bg-green-900 dark:text-green-800 p-1 rounded-md">
            <small>{{message.sentAt | date: 'hh:mm'}}</small>
          </mark>
        </div>
      </div>

      <!--Other user-->
      <div *ngIf="message.senderId !== userId"
           class="bg-blue-50 dark:bg-green-900 rounded-md mt-2 p-3 w-fit">

        <div *ngIf="userImageService.getUserProfileById(message.senderId); else elseBlock">
          <img
            class="relative inline-flex items-center justify-center w-10 h-10 p-1 rounded-full ring-2 ring-gray-300 dark:ring-gray-500"
            [src]="userImageService.getUserProfileById(message.senderId)" alt="Bordered avatar">
        </div>
        <ng-template #elseBlock>
          <div
            class="relative inline-flex items-center justify-center w-10 h-10 overflow-hidden bg-gray-100 rounded-full dark:bg-gray-600">
            <span
              class="font-medium text-gray-600 dark:text-gray-300">{{getUserCredentials(message.senderId)}}</span>
          </div>
        </ng-template>

        <mark
          class="me-4 p-1 text-blue-900 dark:text-blue-200 bg-transparent
            font-bold">{{getUserBySenderId(message.senderId).username}}</mark>
        <span class="text-blue-800 dark:text-blue-200 dark:bg-green-800 me-4">{{message.content}}</span>
        <mark
          class="text-blue-900 bg-blue-300 dark:bg-blue-900 dark:text-blue-800 p-1 rounded-md">
          <small>{{message.sentAt | date: 'hh:mm'}}</small>
        </mark>

      </div>
    </ng-template>
    <div #bottom></div>
  </div>


  <!---Message input--->
<!--  <label for="search" class="mb-2 text-sm font-medium text-gray-900 sr-only dark:text-white">Send</label>-->
<!--  <div class="fixed z-50 bottom-4 w-96">-->
<!--    <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">-->
<!--      <svg class="w-5 h-5 text-gray-500 dark:text-gray-400" fill="none" stroke="currentColor" stroke-width="1.5"-->
<!--           viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">-->
<!--        <path stroke-linecap="round" stroke-linejoin="round"-->
<!--              d="M2.25 12.76c0 1.6 1.123 2.994 2.707 3.227 1.087.16 2.185.283 3.293.369V21l4.076-4.076a1.526 1.526 0 011.037-.443 48.282 48.282 0 005.68-.494c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0012 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018z"></path>-->
<!--      </svg>-->
<!--    </div>-->
<!--    <form (ngSubmit)="sendMessage()">-->
<!--      <input type="text" id="search"-->
<!--             name="message"-->
<!--             [(ngModel)]="message"-->
<!--             class="block w-full p-4 pl-10 text-sm text-gray-900 border border-gray-300 rounded-lg bg-gray-50 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"-->
<!--             placeholder="Your message..."-->
<!--             required-->
<!--             autocomplete="off">-->
<!--      <button type="submit"-->
<!--              class="text-white absolute right-2.5 bottom-2.5 bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-4 py-2 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">-->
<!--        Send-->
<!--      </button>-->
<!--    </form>-->
<!--  </div>-->


  <div class="relative">
    <form (ngSubmit)="sendMessage()">
      <textarea
        [(ngModel)]="message"
        type="text" id="message-input"
        class="p-4 pb-12 block w-full border-gray-200 rounded-md text-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-slate-900 dark:border-gray-700 dark:text-gray-400"
        placeholder="Write your message..."
        required
        spellcheck="true"
        autocomplete="off"></textarea>

      <!-- Toolbar -->
      <div class="absolute bottom-px inset-x-px p-2 rounded-b-md bg-white dark:bg-slate-900">
        <div class="flex justify-between items-center">
          <!-- Button Group -->
          <div class="flex items-center">
            <!-- Mic Button -->
            <button type="button"
                    class="inline-flex flex-shrink-0 justify-center items-center h-8 w-8 rounded-md text-gray-500 hover:text-blue-600 focus:z-10 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all dark:hover:text-blue-500">
              <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                   viewBox="0 0 16 16">
                <path
                  d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/>
                <path d="M11.354 4.646a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708l6-6a.5.5 0 0 1 .708 0z"/>
              </svg>
            </button>
            <!-- End Mic Button -->

            <!-- Attach Button -->
            <button type="button"
                    class="inline-flex flex-shrink-0 justify-center items-center h-8 w-8 rounded-md text-gray-500 hover:text-blue-600 focus:z-10 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all dark:hover:text-blue-500">
              <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                   viewBox="0 0 16 16">
                <path
                  d="M4.5 3a2.5 2.5 0 0 1 5 0v9a1.5 1.5 0 0 1-3 0V5a.5.5 0 0 1 1 0v7a.5.5 0 0 0 1 0V3a1.5 1.5 0 1 0-3 0v9a2.5 2.5 0 0 0 5 0V5a.5.5 0 0 1 1 0v7a3.5 3.5 0 1 1-7 0V3z"/>
              </svg>
            </button>
            <!-- End Attach Button -->
          </div>
          <!-- End Button Group -->

          <!-- Button Group -->
          <div class="flex items-center gap-x-1">
            <!-- Mic Button -->
            <button type="button"
                    class="inline-flex flex-shrink-0 justify-center items-center h-8 w-8 rounded-md text-gray-500 hover:text-blue-600 focus:z-10 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all dark:hover:text-blue-500">
              <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                   viewBox="0 0 16 16">
                <path
                  d="M3.5 6.5A.5.5 0 0 1 4 7v1a4 4 0 0 0 8 0V7a.5.5 0 0 1 1 0v1a5 5 0 0 1-4.5 4.975V15h3a.5.5 0 0 1 0 1h-7a.5.5 0 0 1 0-1h3v-2.025A5 5 0 0 1 3 8V7a.5.5 0 0 1 .5-.5z"/>
                <path d="M10 8a2 2 0 1 1-4 0V3a2 2 0 1 1 4 0v5zM8 0a3 3 0 0 0-3 3v5a3 3 0 0 0 6 0V3a3 3 0 0 0-3-3z"/>
              </svg>
            </button>
            <!-- End Mic Button -->

            <!-- Send Button -->
            <button type="submit"
                    class="inline-flex flex-shrink-0 justify-center items-center h-8 w-8 rounded-md text-white bg-blue-600 hover:bg-blue-500 focus:z-10 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all">
              <svg class="h-3.5 w-3.5" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                   viewBox="0 0 16 16">
                <path
                  d="M15.964.686a.5.5 0 0 0-.65-.65L.767 5.855H.766l-.452.18a.5.5 0 0 0-.082.887l.41.26.001.002 4.995 3.178 3.178 4.995.002.002.26.41a.5.5 0 0 0 .886-.083l6-15Zm-1.833 1.89L6.637 10.07l-.215-.338a.5.5 0 0 0-.154-.154l-.338-.215 7.494-7.494 1.178-.471-.47 1.178Z"/>
              </svg>
            </button>
            <!-- End Send Button -->
          </div>
          <!-- End Button Group -->
        </div>
      </div>
      <!-- End Toolbar -->
    </form>
  </div>
  <!-- End Input -->
</div>

<!-- Delete chat modal -->
<div id="popup-modal" tabindex="-1"
     class="
     fixed top-0 left-0 right-0 z-50 hidden p-4 overflow-x-hidden overflow-y-auto md:inset-0 h-[calc(100%-1rem)] max-h-full"
     style="backdrop-filter: blur(15px)!important;">
  <div class="relative w-full max-w-md max-h-full"
       style="top: 300px !important;">
    <div class="relative bg-white rounded-lg shadow dark:bg-gray-700">
      <button
        (click)="closeDeleteModal()"
        type="button"
        class="absolute top-3 right-2.5 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center dark:hover:bg-gray-800 dark:hover:text-white"
        data-modal-hide="popup-modal">
        <svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"
             xmlns="http://www.w3.org/2000/svg">
          <path fill-rule="evenodd"
                d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                clip-rule="evenodd"></path>
        </svg>
        <span class="sr-only">Close modal</span>
      </button>
      <div class="p-6 text-center">
        <svg aria-hidden="true" class="mx-auto mb-4 text-gray-400 w-14 h-14 dark:text-gray-200" fill="none"
             stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <h3 class="mb-5 text-lg font-normal text-gray-500 dark:text-gray-400">Are you sure you want to delete this
          product?</h3>
        <button data-modal-hide="popup-modal" type="button"
                (click)="deleteChat()"
                class="text-white bg-red-600 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-red-300 dark:focus:ring-red-800 font-medium rounded-lg text-sm inline-flex items-center px-5 py-2.5 text-center mr-2">
          Yes, I'm sure
        </button>
        <button data-modal-hide="popup-modal" type="button"
                class="text-gray-500 bg-white hover:bg-gray-100 focus:ring-4 focus:outline-none focus:ring-gray-200 rounded-lg border border-gray-200 text-sm font-medium px-5 py-2.5 hover:text-gray-900 focus:z-10 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-500 dark:hover:text-white dark:hover:bg-gray-600 dark:focus:ring-gray-600">
          No, cancel
        </button>
      </div>
    </div>
  </div>


  <!--Go to bottom-->
  <div class="fixed right-4 bottom-4 z-50">
    <button type="button"
            (click)="scrollToBottom()"
            class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm p-4 text-center inline-flex items-center mr-2 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"
           xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m0 0l6.75-6.75M12 19.5l-6.75-6.75"></path>
      </svg>
      <span class="sr-only">Icon description</span>
    </button>
  </div>
</div>
<app-edit-chat-modal [modalId]="editModalId" [chatId]="chatId"></app-edit-chat-modal>
